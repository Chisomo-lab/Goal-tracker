<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoalTracker Live</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f5f7fa;
  color: #333;
  padding: 20px;
  margin: 0;
}
h2 {
  color: #1b263b;
  text-align: center;
}
.match {
  background: #fff;
  border-radius: 15px;
  padding: 15px;
  margin: 15px auto;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  max-width: 450px;
  transition: transform 0.2s ease;
}
.match:hover {
  transform: scale(1.02);
}
.teams {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.team {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 45%;
}
.team img {
  width: 35px;
  height: 35px;
}
.score {
  font-size: 1.5em;
  font-weight: bold;
  color: #0d6efd;
}
.details {
  text-align: center;
  color: #555;
  font-size: 13px;
  margin-top: 8px;
}
.stats {
  background: #f8f9fa;
  margin-top: 10px;
  padding: 6px;
  border-radius: 10px;
  font-size: 13px;
  text-align: center;
}
select {
  display: block;
  margin: 10px auto;
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-family: inherit;
}
#status {
  text-align: center;
  font-size: 14px;
  color: #666;
  margin-bottom: 10px;
}

/* Buttons */
.details-btn {
  margin-top: 10px;
  padding: 8px 12px;
  background: #0d6efd;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
}
.details-btn:hover {
  background: #0b5ed7;
}

/* Modal */
#detailsModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 10;
  justify-content: center;
  align-items: center;
}
#detailsBox {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  max-height: 80vh;
  overflow-y: auto;
}
#detailsBox h3 {
  margin: 10px 0 5px;
  color: #0d6efd;
}
#detailsBox ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
#detailsBox li {
  border-bottom: 1px solid #eee;
  padding: 4px 0;
  font-size: 13px;
}
.close-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 6px;
  float: right;
  cursor: pointer;
}

/* Live ticker */
#liveTickerContainer {
  position: relative;
  width: 100%;
  max-width: 500px;
  margin: 0 auto 20px auto;
  height: 50px;
  overflow: hidden;
  border-radius: 8px;
}
#liveTicker {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: white;
  background: #0d6efd;
  padding: 0 10px;
  transition: transform 0.5s ease-in-out;
  white-space: nowrap;
  font-size: 14px;
}
</style>
</head>
<body>

<h2>GoalTracker Live ‚öΩ</h2>

<!-- Live ticker -->
<div id="liveTickerContainer">
  <div id="liveTicker">Loading live matches...</div>
</div>

<!-- League selector -->
<select id="leagueSelect">
  <option value="all">All Leagues</option>
  <option value="39">Premier League</option>
  <option value="140">La Liga</option>
  <option value="135">Serie A</option>
  <option value="78">Bundesliga</option>
  <option value="2">Champions League</option>
</select>

<div id="status">‚è≥ Loading live matches...</div>
<div id="matches"></div>

<!-- Modal -->
<div id="detailsModal">
  <div id="detailsBox">
    <button class="close-btn" onclick="closeModal()">‚úñ</button>
    <div id="detailsContent"></div>
  </div>
</div>

<script>
const API_KEY = "c9526ced8e80398100b5fb481bdbc878"; // Replace with your key

// Request notifications
if ("Notification" in window && Notification.permission !== "granted") {
  Notification.requestPermission();
}

let selectedLeague = "all";
let notifiedGoals = {};
let popupInterval;
let tickerIndex = 0;

document.getElementById("leagueSelect").addEventListener("change", e => {
  selectedLeague = e.target.value;
  getMatches(selectedLeague);
});

// Fetch live matches
function getMatches(leagueId = selectedLeague) {
  document.getElementById("status").innerText = "‚è≥ Updating live data...";
  let url = "https://v3.football.api-sports.io/fixtures?live=all";
  if (leagueId !== "all") url = `https://v3.football.api-sports.io/fixtures?league=${leagueId}&season=2024`;

  fetch(url, { headers: { "x-apisports-key": API_KEY } })
    .then(res => res.json())
    .then(data => {
      const matches = data.response;
      const container = document.getElementById("matches");
      container.innerHTML = "";

      if (!matches || matches.length === 0) {
        container.innerHTML = "<p>No live matches right now.</p>";
        document.getElementById("status").innerText = "‚úÖ Last updated: " + new Date().toLocaleTimeString();
        return;
      }

      matches.forEach(match => {
        const home = match.teams.home.name;
        const away = match.teams.away.name;
        const scoreHome = match.goals.home ?? 0;
        const scoreAway = match.goals.away ?? 0;
        const status = match.fixture.status.short;
        const time = new Date(match.fixture.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const logoHome = match.teams.home.logo;
        const logoAway = match.teams.away.logo;
        const fixtureId = match.fixture.id;

        const div = document.createElement("div");
        div.classList.add("match");
        div.innerHTML = `
          <div class="teams">
            <div class="team"><img src="${logoHome}" alt="${home}">${home}</div>
            <div class="score">${scoreHome} - ${scoreAway}</div>
            <div class="team" style="justify-content: flex-end;">${away}<img src="${logoAway}" alt="${away}"></div>
          </div>
          <div class="details">${match.league.name} ‚Ä¢ ${status} ‚Ä¢ ${time}</div>
          <div class="stats">Loading stats...</div>
          <button class="details-btn" onclick="viewDetails(${fixtureId})">üìã View Match Details</button>
        `;
        container.appendChild(div);

        getStats(fixtureId, div.querySelector(".stats"));
      });

      updateLiveTicker(matches);
      document.getElementById("status").innerText = "‚úÖ Last updated: " + new Date().toLocaleTimeString();
    })
    .catch(err => console.error(err));
}

// Fetch match stats
function getStats(fixtureId, statsDiv) {
  fetch(`https://v3.football.api-sports.io/fixtures/statistics?fixture=${fixtureId}`, { headers: { "x-apisports-key": API_KEY } })
    .then(res => res.json())
    .then(data => {
      if (!data.response || data.response.length < 2) {
        statsDiv.innerHTML = "No stats available yet.";
        return;
      }
      const homeStats = data.response[0].statistics;
      const awayStats = data.response[1].statistics;

      const possessionHome = homeStats.find(s => s.type === "Ball Possession")?.value || "0%";
      const possessionAway = awayStats.find(s => s.type === "Ball Possession")?.value || "0%";
      const shotsHome = homeStats.find(s => s.type === "Total Shots")?.value || 0;
      const shotsAway = awayStats.find(s => s.type === "Total Shots")?.value || 0;
      const shotsOnTargetHome = homeStats.find(s => s.type === "Shots on Goal")?.value || 0;
      const shotsOnTargetAway = awayStats.find(s => s.type === "Shots on Goal")?.value || 0;

      statsDiv.innerHTML = `
        <small>Possession: ${possessionHome} - ${possessionAway}</small><br>
        <small>Shots: ${shotsHome} - ${shotsAway}</small><br>
        <small>On Target: ${shotsOnTargetHome} - ${shotsOnTargetAway}</small>
      `;
    })
    .catch(() => statsDiv.innerHTML = "‚ö†Ô∏è Stats unavailable.");
}

// Popup with lineups, stats, goal events
function viewDetails(fixtureId) {
  const modal = document.getElementById("detailsModal");
  const content = document.getElementById("detailsContent");
  modal.style.display = "flex";

  function loadDetails() {
    content.innerHTML = "<p>Loading match details...</p>";

    fetch(`https://v3.football.api-sports.io/fixtures/lineups?fixture=${fixtureId}`, { headers: { "x-apisports-key": API_KEY } })
      .then(res => res.json())
      .then(data => {
        if (!data.response || data.response.length < 2) {
          content.innerHTML = "<p>No lineup info available yet.</p>";
          return;
        }
        const home = data.response[0];
        const away = data.response[1];

        content.innerHTML = `
          <h3>${home.team.name} (${home.formation})</h3>
          <ul>${home.startXI.map(p => `<li>${p.player.name}</li>`).join("")}</ul>
          <h3>${away.team.name} (${away.formation})</h3>
          <ul>${away.startXI.map(p => `<li>${p.player.name}</li>`).join("")}</ul>
        `;
        getPlayerStats(fixtureId, content);
        getGoalEvents(fixtureId, content);
      })
      .catch(() => { content.innerHTML = "<p>Error loading match details.</p>"; });
  }

  loadDetails();
  if (popupInterval) clearInterval(popupInterval);
  popupInterval = setInterval(loadDetails, 20000);
}

function closeModal() {
  document.getElementById("detailsModal").style.display = "none";
  if (popupInterval) clearInterval(popupInterval);
}

// Player stats
function getPlayerStats(fixtureId, content) {
  fetch(`https://v3.football.api-sports.io/fixtures/players?fixture=${fixtureId}`, { headers: { "x-apisports-key": API_KEY } })
    .then(res => res.json())
    .then(data => {
      if (!data.response || data.response.length === 0) { content.innerHTML += "<p>No player stats yet.</p>"; return; }
      const homeTeam = data.response[0];
      const awayTeam = data.response[1];

      content.innerHTML += `
        <h3>${homeTeam.team.name} - Player Stats</h3>
        <ul>${homeTeam.players.map(p=>{
          const stats=p.statistics[0]; const goals=stats.goals.total||0; const assists=stats.goals.assists||0;
          const yellow=stats.cards.yellow||0; const red=stats.cards.red||0;
          return `<li>${p.player.name} ‚Äì ‚öΩ ${goals} | üÖ∞Ô∏è ${assists} | üü® ${yellow} | üü• ${red}</li>`;
        }).join("")}</ul>
        <h3>${awayTeam.team.name} - Player Stats</h3>
        <ul>${awayTeam.players.map(p=>{
          const stats=p.statistics[0]; const goals=stats.goals.total||0; const assists=stats.goals.assists||0;
          const yellow=stats.cards.yellow||0; const red=stats.cards.red||0;
          return `<li>${p.player.name} ‚Äì ‚öΩ ${goals} | üÖ∞Ô∏è ${assists} | üü® ${yellow} | üü• ${red}</li>`;
        }).join("")}</ul>
      `;
    })
    .catch(()=> content.innerHTML += "<p>‚ö†Ô∏è Error loading player stats.</p>");
}

// Goal events
function getGoalEvents(fixtureId, content) {
  fetch(`https://v3.football.api-sports.io/fixtures/events?fixture=${fixtureId}`, { headers: { "x-apisports-key": API_KEY } })
    .then(res => res.json())
    .then(data => {
      if (!data.response || data.response.length === 0) { content.innerHTML += "<p>No match events yet.</p>"; return; }
      const goals = data.response.filter(event => event.type==="Goal");
      if (goals.length===0){ content.innerHTML += "<p>No goals yet.</p>"; return; }
      let html="<h3>‚öΩ Goals</h3><ul>";
      goals.forEach(g=>{
        html += `<li
